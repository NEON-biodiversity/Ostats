<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multivariate O-statistics • Ostats</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multivariate O-statistics">
<meta property="og:description" content="Ostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Ostats</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Ostats-introduction.html">O-stats: pairwise community-level niche overlap statistics</a>
    </li>
    <li>
      <a href="../articles/Ostats-multivariate.html">Multivariate O-statistics</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multivariate O-statistics</h1>
                        <h4 class="author">Quentin D. Read, Isadora E. Fluck</h4>
            
      
      
      <div class="hidden name"><code>Ostats-multivariate.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Ostats</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">pitcher_traits</span><span class="op">)</span></code></pre></div>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>This vignette on multi-variable community-level trait overlap statistics is intended for users who are already familiar with the single-variable O-statistics we introduce in the <a href="Ostats-introduction.html">first package vignette</a>.</p>
<p>We decided to include functions in our package to estimate community-level niche overlap statistics (O-statistics) in multivariate space because of ecologists’ long-standing interest in how species’ niches take shape across multiple environmental dimensions. Since the niche of a species can be determined by several abiotic and biotic variables, Hutchinson (1957) introduced the mathematical formulation of a niche as an <em>n</em>-dimensional hypervolume. Since then, many approaches have been developed to measure the multivariate niche of a species (Green 1971; Swanson et al. 2015). Quantifying the niche in multiple dimensions can help understand how life strategy trade-offs and interactions among multiple traits shape organisms’ structure and function.</p>
<p>Blonder and colleagues rekindled interest in using hypervolumes to describe species’ niches in multiple dimensions. They worked out the underlying theory (Blonder et al. 2014; Lamanna et al. 2014; Blonder 2018) and released the R package <a href="https://cran.r-project.org/package=hypervolume">hypervolume</a>. Their package uses stochastic geometry to estimate multivariate kernel densities and . The multivariate O-statistic estimation in the <code>Ostats</code> package relies on functions imported from <a href="https://cran.r-project.org/package=hypervolume">hypervolume</a>.</p>
<p>In this vignette, we demonstrate how you can use functions in the <code>Ostats</code> package to study trait overlap in multiple dimensions.</p>
</div>
<div id="example-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#example-dataset" class="anchor"></a>Example dataset</h1>
<p>The dataset we use in this vignette includes traits collected on carnivorous pitchers of the northern pitcher plant, <em>Sarracenia purpurea</em>, at 36 sites across the species’ native North American latitudinal range (30.197°N – 53.722°N; Freedman et al. 2021). Pitcher traits measured include orthogonal rosette diameters, pitcher length, pitcher width, keel width, mouth diameter, and lip thickness. See Ellison and Gotelli (2002) for a diagram illustrating traits measured. Site locations and identifying information have been removed for this example.</p>
<p>Here we show a few randomly selected rows from the pitcher traits dataset. Here, all individuals are of the same species. Therefore we will use populations (sites) as the <code>sp</code> variable in our analysis, with a single value for <code>plots</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pitcher_traits</span><span class="op">)</span>, <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">pitcher_traits</span><span class="op">[</span><span class="va">idx</span>,<span class="op">]</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">site_id</th>
<th align="left">plant_id</th>
<th align="right">rosette_diameter_1</th>
<th align="right">rosette_diameter_2</th>
<th align="right">pitcher_length</th>
<th align="right">pitcher_width</th>
<th align="right">keel_width</th>
<th align="right">mouth_diameter</th>
<th align="right">lip_thickness</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>129</td>
<td align="left">S</td>
<td align="left">1</td>
<td align="right">26.5</td>
<td align="right">19.5</td>
<td align="right">16.5</td>
<td align="right">35.48</td>
<td align="right">18.00</td>
<td align="right">18.00</td>
<td align="right">1.15</td>
</tr>
<tr class="even">
<td>187</td>
<td align="left">CRA</td>
<td align="left">11</td>
<td align="right">28.5</td>
<td align="right">33.5</td>
<td align="right">26.2</td>
<td align="right">70.55</td>
<td align="right">34.35</td>
<td align="right">35.40</td>
<td align="right">2.33</td>
</tr>
<tr class="odd">
<td>270</td>
<td align="left">HAR</td>
<td align="left">22</td>
<td align="right">14.5</td>
<td align="right">10.0</td>
<td align="right">15.0</td>
<td align="right">37.38</td>
<td align="right">20.05</td>
<td align="right">16.57</td>
<td align="right">1.42</td>
</tr>
<tr class="even">
<td>277</td>
<td align="left">SAC</td>
<td align="left">5</td>
<td align="right">15.0</td>
<td align="right">4.5</td>
<td align="right">13.0</td>
<td align="right">46.36</td>
<td align="right">14.23</td>
<td align="right">24.86</td>
<td align="right">2.55</td>
</tr>
<tr class="odd">
<td>299</td>
<td align="left">SPR</td>
<td align="left">3</td>
<td align="right">36.5</td>
<td align="right">34.0</td>
<td align="right">23.6</td>
<td align="right">47.23</td>
<td align="right">20.71</td>
<td align="right">23.22</td>
<td align="right">1.49</td>
</tr>
<tr class="even">
<td>307</td>
<td align="left">SPR</td>
<td align="left">11</td>
<td align="right">10.0</td>
<td align="right">3.0</td>
<td align="right">16.3</td>
<td align="right">23.86</td>
<td align="right">13.67</td>
<td align="right">13.40</td>
<td align="right">1.03</td>
</tr>
<tr class="odd">
<td>471</td>
<td align="left">WOO</td>
<td align="left">8</td>
<td align="right">18.5</td>
<td align="right">16.0</td>
<td align="right">17.0</td>
<td align="right">44.16</td>
<td align="right">13.48</td>
<td align="right">26.92</td>
<td align="right">1.39</td>
</tr>
<tr class="even">
<td>509</td>
<td align="left">JON</td>
<td align="left">8</td>
<td align="right">32.0</td>
<td align="right">20.5</td>
<td align="right">22.4</td>
<td align="right">42.50</td>
<td align="right">12.42</td>
<td align="right">27.10</td>
<td align="right">2.36</td>
</tr>
<tr class="odd">
<td>597</td>
<td align="left">FOI</td>
<td align="left">19</td>
<td align="right">16.5</td>
<td align="right">16.0</td>
<td align="right">11.8</td>
<td align="right">29.60</td>
<td align="right">10.14</td>
<td align="right">15.60</td>
<td align="right">1.18</td>
</tr>
<tr class="even">
<td>679</td>
<td align="left">CAS</td>
<td align="left">5</td>
<td align="right">8.5</td>
<td align="right">11.5</td>
<td align="right">13.5</td>
<td align="right">37.36</td>
<td align="right">11.58</td>
<td align="right">19.82</td>
<td align="right">9.82</td>
</tr>
</tbody>
</table>
<p>For a more manageable example, let’s select five sites.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'COL'</span>, <span class="st">'CRI'</span>, <span class="st">'FLK'</span>, <span class="st">'MYR'</span>, <span class="st">'SAC'</span><span class="op">)</span>
<span class="va">pitcher_traits</span> <span class="op">&lt;-</span> <span class="va">pitcher_traits</span><span class="op">[</span><span class="va">pitcher_traits</span><span class="op">$</span><span class="va">site_id</span> <span class="op">%in%</span> <span class="va">sites</span>, <span class="op">]</span></code></pre></div>
</div>
<div id="calculating-hypervolume-o-statistics" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-hypervolume-o-statistics" class="anchor"></a>Calculating hypervolume O-statistics</h1>
<p>Here we calculate the univariate O-statistics for each of the pitcher traits separately, then a single multivariate O-statistic representing overlap of the trait hypervolumes.</p>
<p>When estimating hypervolumes, as with any other multivariate analysis, it is critical to ensure that the hypervolume axes are not too highly correlated with one another. If traits are too highly correlated, the calculated hypervolume will not accurately represent the distribution in trait space. In this case, we resolve the issue by excluding a few of the traits with high correlations. You could also choose to use a variance maximization procedure like PCA instead.</p>
<p>First ensure that the data are in the appropriate form for <code><a href="../reference/Ostats.html">Ostats()</a></code> and <code><a href="../reference/Ostats_multivariate.html">Ostats_multivariate()</a></code>. For this example we will remove individuals with incomplete data. Using <code><a href="https://rdrr.io/r/stats/cor.html">cor()</a></code> on the cleaned dataset, we can see the relatively high correlations among some of the traits.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pitcher_traits</span> <span class="op">&lt;-</span> <span class="va">pitcher_traits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">pitcher_traits</span><span class="op">)</span>, <span class="op">]</span>

<span class="va">pitcher_sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">pitcher_traits</span><span class="op">$</span><span class="va">site_id</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">pitcher_traits</span><span class="op">[</span>, <span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;                    rosette_diameter_1 rosette_diameter_2 pitcher_length</span>
<span class="co">#&gt; rosette_diameter_1               1.00               0.83           0.64</span>
<span class="co">#&gt; rosette_diameter_2               0.83               1.00           0.71</span>
<span class="co">#&gt; pitcher_length                   0.64               0.71           1.00</span>
<span class="co">#&gt; pitcher_width                    0.38               0.44           0.70</span>
<span class="co">#&gt; keel_width                       0.46               0.51           0.69</span>
<span class="co">#&gt; mouth_diameter                   0.38               0.35           0.43</span>
<span class="co">#&gt; lip_thickness                   -0.11              -0.19          -0.15</span>
<span class="co">#&gt;                    pitcher_width keel_width mouth_diameter lip_thickness</span>
<span class="co">#&gt; rosette_diameter_1          0.38       0.46           0.38         -0.11</span>
<span class="co">#&gt; rosette_diameter_2          0.44       0.51           0.35         -0.19</span>
<span class="co">#&gt; pitcher_length              0.70       0.69           0.43         -0.15</span>
<span class="co">#&gt; pitcher_width               1.00       0.82           0.49          0.12</span>
<span class="co">#&gt; keel_width                  0.82       1.00           0.29         -0.03</span>
<span class="co">#&gt; mouth_diameter              0.49       0.29           1.00          0.47</span>
<span class="co">#&gt; lip_thickness               0.12      -0.03           0.47          1.00</span></code></pre></div>
<p>We select four traits that represent dimensions of different parts of the plant’s anatomy. As a result they are relatively uncorrelated with one another: rosette diameter, pitcher width, mouth diameter, and lip thickness.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">traits_to_use</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rosette_diameter_1"</span>, <span class="st">"pitcher_width"</span>, <span class="st">"mouth_diameter"</span>, <span class="st">"lip_thickness"</span><span class="op">)</span>

<span class="va">pitcher_trait_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">pitcher_traits</span><span class="op">[</span>, <span class="va">traits_to_use</span><span class="op">]</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;                    rosette_diameter_1 pitcher_width mouth_diameter</span>
<span class="co">#&gt; rosette_diameter_1               1.00          0.38           0.38</span>
<span class="co">#&gt; pitcher_width                    0.38          1.00           0.49</span>
<span class="co">#&gt; mouth_diameter                   0.38          0.49           1.00</span>
<span class="co">#&gt; lip_thickness                   -0.11          0.12           0.47</span>
<span class="co">#&gt;                    lip_thickness</span>
<span class="co">#&gt; rosette_diameter_1         -0.11</span>
<span class="co">#&gt; pitcher_width               0.12</span>
<span class="co">#&gt; mouth_diameter              0.47</span>
<span class="co">#&gt; lip_thickness               1.00</span></code></pre></div>
<p>Next we center and scale all the columns to ensure that the hypervolume O-statistic is not influenced by different magnitudes of each trait.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix</span>, <span class="fl">2</span>, <span class="va">range</span><span class="op">)</span>
<span class="co">#&gt;      rosette_diameter_1 pitcher_width mouth_diameter lip_thickness</span>
<span class="co">#&gt; [1,]                  4         22.28           9.43          0.60</span>
<span class="co">#&gt; [2,]                 65         83.01          36.66          6.44</span>

<span class="va">pitcher_trait_matrix_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix_scaled</span>, <span class="fl">2</span>, <span class="va">range</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt;      rosette_diameter_1 pitcher_width mouth_diameter lip_thickness</span>
<span class="co">#&gt; [1,]              -1.31         -1.96          -2.64         -1.81</span>
<span class="co">#&gt; [2,]               3.62          4.36           2.31          3.21</span></code></pre></div>
<div id="univariate-versus-multivariate-o-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#univariate-versus-multivariate-o-statistics" class="anchor"></a>Univariate versus multivariate O-statistics</h2>
<p>For demonstration purposes, let’s calculate the univariate O-statistics for each of the four traits so that we can compare them to the multivariate statistic.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pitcher_univariate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Ostats.html">Ostats</a></span><span class="op">(</span>traits <span class="op">=</span> <span class="va">pitcher_trait_matrix_scaled</span>,
                             plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix_scaled</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                             sp <span class="op">=</span> <span class="va">pitcher_sites</span>,
                             run_null_model <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<p>Now calculate the multivariate O-statistic for the traits combined. We still specify the argument <code>random_seed</code> even in the absence of a null model, because the hypervolumes are constructed with a stochastic algorithm.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pitcher_multivariate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Ostats_multivariate.html">Ostats_multivariate</a></span><span class="op">(</span>traits <span class="op">=</span> <span class="va">pitcher_trait_matrix_scaled</span>,
                                            plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix_scaled</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                                            sp <span class="op">=</span> <span class="va">pitcher_sites</span>,
                                            random_seed <span class="op">=</span> <span class="fl">333</span>,
                                            run_null_model <span class="op">=</span> <span class="cn">FALSE</span>, 
                                            hypervolume_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'box'</span><span class="op">)</span>,
                                            hypervolume_set_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>num.points.max <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Notice that <code><a href="../reference/Ostats_multivariate.html">Ostats_multivariate()</a></code> accepts additional arguments to <code><a href="https://rdrr.io/pkg/hypervolume/man/hypervolume.html">hypervolume::hypervolume()</a></code>, which it uses to construct the hypervolumes, and <code><a href="https://rdrr.io/pkg/hypervolume/man/hypervolume_set.html">hypervolume::hypervolume_set()</a></code>, which it uses to estimate the hypervolume overlaps. For example, the default method for hypervolume construction is <code>method = "gaussian"</code>, and the default maximum number of points to use for hypervolume overlap estimation is <code>num.points.max = 10^(3+sqrt(n))</code>, where <code>n</code> is the number of dimensions. In this vignette, we modified the defaults to use a different method (<code>"box"</code>) for hypervolume construction and fewer points (<code>1000</code>) for overlap estimation: <code>hypervolume_args = list(method = 'box'), hypervolume_set_args = list(num.points.max = 1000).</code> Those options speed processing time dramatically. See the help documentation for <code><a href="https://rdrr.io/pkg/hypervolume/man/hypervolume.html">hypervolume::hypervolume</a></code> and <code><a href="https://rdrr.io/pkg/hypervolume/man/hypervolume_set.html">hypervolume::hypervolume_set</a></code> for more details.</p>
<p>Compare the univariate and multivariate O-statistics.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pitcher_univariate</span><span class="op">$</span><span class="va">overlaps_norm</span>
<span class="co">#&gt;   rosette_diameter_1 pitcher_width mouth_diameter lip_thickness</span>
<span class="co">#&gt; 1           0.528308     0.7419213      0.8198156     0.5733967</span>

<span class="va">pitcher_multivariate</span><span class="op">$</span><span class="va">overlaps_norm</span>
<span class="co">#&gt;        [,1]</span>
<span class="co">#&gt; 1 0.7441601</span></code></pre></div>
<p>The single multivariate O-statistic is not comparable to the univariate statistics because of differing dimensionality. Therefore we need to evaluate them against null models.</p>
</div>
<div id="null-models-for-multivariate-o-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#null-models-for-multivariate-o-statistics" class="anchor"></a>Null models for multivariate O-statistics</h2>
<p>If <code>run_null_model</code> is set to <code>TRUE</code>, <code><a href="../reference/Ostats_multivariate.html">Ostats_multivariate()</a></code> will do <code>nperm</code> iterations of a null model, defaulting to <code>99</code>. Here we use a smaller number for demonstration purposes.</p>
<p>First, for comparison purposes, run the null models for the univariate O-statistics for each of the four traits.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pitcher_univariate_withnull</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Ostats.html">Ostats</a></span><span class="op">(</span>traits <span class="op">=</span> <span class="va">pitcher_trait_matrix_scaled</span>,
                                      plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix_scaled</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                                      sp <span class="op">=</span> <span class="va">pitcher_sites</span>,
                                      random_seed <span class="op">=</span> <span class="fl">666</span>,
                                      run_null_model <span class="op">=</span> <span class="cn">TRUE</span>,
                                      nperm <span class="op">=</span> <span class="fl">50</span>
<span class="op">)</span></code></pre></div>
<p>Next, do the same for the multivariate overlap.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pitcher_multivariate_withnull</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Ostats_multivariate.html">Ostats_multivariate</a></span><span class="op">(</span>traits <span class="op">=</span> <span class="va">pitcher_trait_matrix_scaled</span>,
                                            plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix_scaled</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                                            sp <span class="op">=</span> <span class="va">pitcher_sites</span>,
                                            random_seed <span class="op">=</span> <span class="fl">555</span>,
                                            run_null_model <span class="op">=</span> <span class="cn">TRUE</span>,
                                            nperm <span class="op">=</span> <span class="fl">50</span>,
                                            hypervolume_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'box'</span><span class="op">)</span>,
                                            hypervolume_set_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>num.points.max <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Comparing the standardized effect sizes, normalized to remove the effect of varying sample sizes across sites, we can see that three of the four individual traits have O-statistics significantly lower than the null expectation (lower than the 2.5%ile of the null distribution), while the multivariate O-statistic is not significantly different from the null expectation:</p>
<table class="table">
<thead><tr class="header">
<th align="left">O-statistic</th>
<th align="right">rosette diameter</th>
<th align="right">pitcher width</th>
<th align="right">mouth diameter</th>
<th align="right">lip thickness</th>
<th align="right">multivariate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">observed</td>
<td align="right">0.528</td>
<td align="right">0.742</td>
<td align="right">0.820</td>
<td align="right">0.573</td>
<td align="right">0.745</td>
</tr>
<tr class="even">
<td align="left">null 2.5%</td>
<td align="right">0.722</td>
<td align="right">0.760</td>
<td align="right">0.767</td>
<td align="right">0.731</td>
<td align="right">0.727</td>
</tr>
<tr class="odd">
<td align="left">null 97.5%</td>
<td align="right">0.866</td>
<td align="right">0.875</td>
<td align="right">0.888</td>
<td align="right">0.869</td>
<td align="right">0.786</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="visualizing-hypervolume-o-statistics" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizing-hypervolume-o-statistics" class="anchor"></a>Visualizing hypervolume O-statistics</h1>
<p>We can visualize the overlap of the different hypervolumes using the function <code><a href="../reference/Ostats_multivariate_plot.html">Ostats_multivariate_plot()</a></code>. This function returns a list of plot objects, one for each community. Each plot displays an upper triangular matrix of panels, one for each pair of traits, with the cross-sections of the hypervolumes in those two dimensions, as well as the raw data points.</p>
<p>For example, we can plot the overlap of the hypervolumes in 4-dimensional space formed by the individual traits of the pitcher plants at each site. Note that although we calculated the hypervolume overlaps on the scaled traits, we are plotting the hypervolumes using the unscaled trait axes. However, this requires us to set the argument <code>contour_level = 0.0001</code> because the densities of the unscaled hypervolumes are too low to plot using the default <code>contour_level = 0.01</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Ostats_multivariate_plot.html">Ostats_multivariate_plot</a></span><span class="op">(</span>plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                         sp <span class="op">=</span> <span class="va">pitcher_sites</span>,
                         traits <span class="op">=</span> <span class="va">pitcher_trait_matrix</span>,
                         contour_level <span class="op">=</span> <span class="fl">0.0001</span>,
                         overlap_dat <span class="op">=</span> <span class="va">pitcher_multivariate</span>
<span class="op">)</span></code></pre></div>
<p><img src="Ostats-multivariate_files/figure-html/default%20plot-1.png" width="864"></p>
<p>We can customize the plot by supplying a color palette to the <code>colorvalues</code> argument (the default is a colorblind-friendly palette imported from <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">viridis</a>), and add additional spacing around the hypervolume contours using the <code>axis_expansion</code> argument. The default value of this argument is <code>0.01</code>, or 1% in all directions. Finally, we can suppress plotting the raw data and only plot the contours using <code>plot_points = FALSE</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/Ostats_multivariate_plot.html">Ostats_multivariate_plot</a></span><span class="op">(</span>plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pitcher_trait_matrix</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
                         sp <span class="op">=</span> <span class="va">pitcher_sites</span>,
                         traits <span class="op">=</span> <span class="va">pitcher_trait_matrix</span>,
                         contour_level <span class="op">=</span> <span class="fl">0.0001</span>,
                         overlap_dat <span class="op">=</span> <span class="va">pitcher_multivariate</span>,
                         colorvalues <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sites</span><span class="op">)</span><span class="op">)</span>,
                         axis_expansion <span class="op">=</span> <span class="fl">0.05</span>,
                         plot_points <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<p><img src="Ostats-multivariate_files/figure-html/custom%20plot-1.png" width="864"></p>
<p>The code underlying <code><a href="../reference/Ostats_multivariate_plot.html">Ostats_multivariate_plot()</a></code> was adapted from the <code>plot.Hypervolumelist()</code> function in the <a href="https://cran.r-project.org/package=hypervolume">hypervolume</a> package.</p>
</div>
<div id="some-practical-notes" class="section level1">
<h1 class="hasAnchor">
<a href="#some-practical-notes" class="anchor"></a>Some practical notes</h1>
<p>When working with multivariate trait data, it is critical to examine correlations among traits in the dataset. If you construct hypervolumes with traits that are highly correlated and measure their overlap, you will get spurious results. In addition, it’s important to consider the issue of dimensionality. It is difficult if not impossible to estimate hypervolume overlap in more than five or six dimensions. A study that quantified trait space across a wide variety of systems found that using three to six dimensions jointly maximizes trait space quality and computational feasibility (Mouillot et al., in press). Others have critiqued using hypervolume kernel density estimation to quantify species niches (Qiao et al. 2017); the technical issues only get worse as more dimensions are added. Using a variance maximization technique like PCA could be helpful to reduce dimensionality. Regardless of what method you choose, the absolute amount of overlap can’t be compared among hypervolumes with different dimensionality, making it especially important to compare the O-statistics with null distributions.</p>
<p>Finally, some work has shown that trait-based inference derived from analyzing multiple traits may not improve our understanding of biological systems in many cases, relative to inference based on one well-chosen biologically meaningful trait (CITE, but see Kraft et al. 2015). In light of that, you should carefully consider which trait or traits are relevant to your research question. Whenever possible, compare inference based on single trait overlap to the inference you get when considering multiple traits, and select the most parsimonious model.</p>
</div>
<div id="works-cited" class="section level1">
<h1 class="hasAnchor">
<a href="#works-cited" class="anchor"></a>Works cited</h1>
<ul>
<li>Blonder, B. 2018. Hypervolume concepts in niche- and trait-based ecology. <em>Ecography</em> 41:1441–1455.</li>
<li>Blonder, B., C. Lamanna, C. Violle, and B.J. Enquist, 2014. The n-dimensional hypervolume. <em>Global Ecology and Biogeography</em> 23:595–609.</li>
<li>Ellison, A.M., and N.J. Gotelli. 2002. Nitrogen availability alters the expression of carnivory in the Northern Pitcher Plant, <em>Sarracenia purpurea</em>. <em>Proceedings of the National Academy of Science</em> 99(7):4409-12.</li>
<li>Freedman, Z.B., A. McGrew, B. Baiser, M. Besson, D. Gravel, T. Poisot, S. Record, L.B. Trotta, and N.J. Gotelli. 2021. Environment-host-microbial interactions shape the <em>Sarracenia purpurea</em> microbiome at the continental scale. <em>Ecology</em> 102(5):e03308.</li>
<li>Green, R.H. 1971. A multivariate statistical approach to the Hutchinsonian niche: bivalve molluscs of central Canada. <em>Ecology</em> 52:543–556.</li>
<li>Hutchinson, G.E. 1957. Concluding remarks. <em>Cold Spring Harb. Symp. Quant. Biol.</em> 22:415–427.</li>
<li>Kraft, N.J.B., O. Godoy, and J.M. Levine. 2015. Plant functional traits and the multidimensional nature of species coexistence. <em>Proceedings of the National Academy of Sciences</em> 112:797–802.</li>
<li>Lamanna, C., B. Blonder, C. Violle, N.J.B. Kraft, B. Sandel, I. Imova, J.C. Donoghue, J.-C. Svenning, B.J. McGill, B. Boyle, V. Buzzard, S. Dolins., P.M. Jorgensen., A. Marcuse-Kubitza, N. Morueta-Holme, R.K. Peet, W.H. Piel, J. Regetz, M. Schildhauer, N. Spencer, B. Thiers, S.K. Wiser., and B.J. Enquist. 2014. Functional trait space and the latitudinal diversity gradient. <em>Proceedings of the National Academy of Sciences</em> 111:13745–13750.</li>
<li>Mouillot, D., N. Loiseau, M. Grenié, A.C. Algar, M. Allegra, M.M. Cadotte, N. Casajus, P. Denelle, M. Guéguen, A. Maire, B. Maitner, B.J. McGill, M. McLean, N. Mouquet, F. Munoz, W. Thuiller, S. Villéger, C. Violle, and A. Auber. The dimensionality and structure of species trait spaces. <em>Ecology Letters</em>, in press.</li>
<li>Qiao, H., L.E. Escobar, E.E. Saupe, L. Ji, and J. Soberón. 2017. A cautionary note on the use of hypervolume kernel density estimators in ecological niche modelling. <em>Global Ecology and Biogeography</em> 26:1066–1070.</li>
<li>Swanson, H.K., M. Lysy, M. Power, A.D. Stasko, J.D. Johnson, and J.D. Reist. 2015. A new probabilistic method for quantifying n-dimensional ecological niches and niche overlap. <em>Ecology</em> 96:318–324.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Quentin D. Read, Arya Yue, Isadora E. Fluck, Benjamin Baiser, John M. Grady, Phoebe L. Zarnetske, Sydne Record.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
