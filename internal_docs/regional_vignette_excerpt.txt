### THIS IS THE SNIPPET OF THE VIGNETTE FOR OSTATS_REGIONAL
### TEMPORARILY REMOVED FROM VIGNETTE SO SITE WILL BUILD

## Overlap statistics for linear data against a regional null model

`Ostats_regional` is a function that calculates overlap statistics against a regional null model, if the user has trait measurements for the regional species pool. The null model is generated by randomly sampling data from the regional species pool. In this function, the area under all density functions is normalized to 1. This means that the argument norm = TRUE is applied without the option of taking species abundances into account, which is more appropriate if the species abundances are highly variable. Other arguments in `Ostats_regional` are similar in use to `Ostats`. The user can customize `nperm`, `nullqs`, and pass arguments to the underlying `stats::density()` function.

### EXAMPLE: How to calculate and compare overlap of body sizes for all small mammal species in a community against available data for a larger regional pool?

In the example below, the sample dataset `reg_pool` is used as a regional pool dataset across space and time. Each row represents an individual small mammal that was trapped and weighed, with its species identity and body mass in grams. The weight measurements have already been log-transformed. It includes small mammal capture records for two NEON sites, Harvard Forest (HARV) and Bartlett Forest (BART), from 2013 to 2018. Data for these two sites can be used as regional data because both sites are from the same ecoclimatic domain classified by NEON (the Northeast Domain).

```{r}
# Take a look at the first six rows of the reg_pool dataframe
head(reg_pool)
```

In this example, we compare the small mammal data at Harvard in 2018 against the regional pool defined as the trait distributions of Harvard and Bartlett from 2013-2018.

```{r echo = T, results='hide'}
# Create year column for subsetting
reg_pool$year <- format(as.Date(reg_pool$endDate), '%Y')

# Subset 2018 NEON small mammal data for 'HARV' and 'BART'
HARV2018 <- reg_pool[reg_pool$siteID %in% c('HARV') & reg_pool$year %in% 2018, ]

# Subset 2013-2018 NEON small mammal data for 'HARV' and 'BART' sites, which will serve as the regional pool data in space and time for comparison with 'HARV' and 'BART' 2018 data.
regHARV <- reg_pool[reg_pool$siteID %in% 'HARV', ]
regBART <- reg_pool[reg_pool$siteID %in% 'BART', ]

# Overlap statistics against the overall data (HARV and BART, sites from the same domain, across all available years)

reg_pool_traits <- list (as.matrix(regHARV[, 'log_weight', drop = FALSE]),
                         as.matrix(regBART[, 'log_weight', drop = FALSE]))
reg_pool_sp <- list(factor(regHARV$taxonID), factor(regBART$taxonID))
names(reg_pool_traits) <- c("HARV", "BART")
names(reg_pool_sp) <- c("HARV", "BART")

Ostats_reg_example <- Ostats_regional(traits = as.matrix(HARV2018[, 'log_weight', drop = FALSE]),
                                      plots = factor(HARV2018$siteID),
                                      sp = factor(HARV2018$taxonID),
                                      reg_pool_traits = reg_pool_traits,
                                      reg_pool_sp = reg_pool_sp,
                                      random_seed = 520)
```

The function evaluates the overlap statistics against a regional species pool null model. This regional null model tests whether individual species’ body size distributions were more evenly spaced along the body size axis than expected by chance. This approach evaluates the z‐score of each observed community against the distribution of 999 null communities drawn from body size measurements from the regional species pool in which species body size means were shuffled randomly. This process retains the shape and width of the distribution around the mean for each species.

Effect size statistics are calculated against a total-pool null model and a by-species null model, respectively. The total-pool null model is generated by sampling n trait measurements (n = number of trait measurements for the community) from the regional pool of traits measurements and calculates the pairwise overlap between the random sample and the regional pool. The by-species null model is calculated by sampling trait measurements of the same species from the regional pool for each species present in the community to calculate pairwise overlap between the sample and the whole regional pool.

```{r}
Ostats_reg_example
```
The output of the function `Ostats_regional` is similar to that of `Ostats`, with a list containing overlaps_reg, standardized effect size statistics for the total-pool null model and for the by-species null model. In this example for the total-pool and by-species null models, regardless of whether normalized or non-normalized values are calculated, the community overlap of Harvard Forest (HARV) in 2018 has lower value than the lower standardized effect size quantile limit relative to the regional pool of HARV and BART over time, suggesting that HARV small mammal body size distributions are less similar than expected by chance.

Currently, `Ostats_regional` only supports linear data calculation.
